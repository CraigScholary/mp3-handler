server:
  port: 8080
  shutdown: graceful

spring:
  application:
    name: mp3-handler
  servlet:
    multipart:
      max-file-size: 500MB
      max-request-size: 500MB
  lifecycle:
    timeout-per-shutdown-phase: 30s

# Object Store Configuration (MinIO/S3)
objectstore:
  # Endpoint - override with OBJECTSTORE_ENDPOINT environment variable
  endpoint: ${OBJECTSTORE_ENDPOINT:http://localhost:9000}
  # Access credentials - override with environment variables in production
  accessKey: ${OBJECTSTORE_ACCESS_KEY:admin}
  secretKey: ${OBJECTSTORE_SECRET_KEY:admin123}
  # Default bucket for audio files
  bucket: ${OBJECTSTORE_BUCKET:audio-dev}
  # AWS region (optional for MinIO, required for real S3)
  region: ${OBJECTSTORE_REGION:us-east-1}
  # Path-style access required for MinIO (virtual-hosted style for AWS S3)
  pathStyleAccess: ${OBJECTSTORE_PATH_STYLE:true}

# Whisper API Configuration
whisper:
  # Base URL for the Whisper transcription service (faster-whisper Python service)
  baseUrl: ${WHISPER_BASE_URL:http://localhost:8091}
  # Connection timeout in seconds
  connectTimeout: 10
  # Read timeout in seconds (transcription can take a while)
  # For 1-hour chunks, transcription can take 10-15 minutes
  readTimeout: ${WHISPER_TIMEOUT_SECONDS:1800}
  # Max retry attempts for transient failures
  maxRetries: ${WHISPER_MAX_RETRIES:3}

# Transcription Processing Configuration
transcription:
  # Chunking configuration
  chunking:
    # Maximum chunk duration in seconds (Whisper limit)
    maxChunkSeconds: 3600  # 1 hour
    # Minimum overlap in seconds (will extend if insufficient words)
    minOverlapSeconds: 30
    # Maximum supported audio file duration in hours
    maxFileDurationHours: 24
  
  # Word matching merge configuration
  merge:
    # Context window for word matching (words before/after)
    contextWindowWords: 10
    # Minimum similarity threshold for fuzzy matching (0.0-1.0)
    minSimilarityThreshold: 0.8
  
  # Temporary file storage location (uses system temp if not specified)
  # Only individual chunks are stored here, not entire files
  tempDir: ${java.io.tmpdir}/mp3handler
  
  # Thread pool size for async processing
  asyncExecutorThreads: 4
  
  # Maximum queue size for async jobs
  asyncExecutorQueueSize: 100
  
  # Chunk cache configuration (for resume functionality)
  cache:
    # Maximum number of chunks to cache
    maxSize: 1000
    # Time to keep cached chunks (in hours)
    ttlHours: 24

# Job Store Configuration (Caffeine)
jobstore:
  # Maximum number of jobs to keep in memory
  maxSize: 1000
  # Time to keep completed jobs before eviction (in minutes)
  expireAfterMinutes: 60

# Swagger/OpenAPI
springdoc:
  api-docs:
    path: /api-docs
  swagger-ui:
    path: /swagger-ui.html

# Actuator
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true

# Logging
logging:
  level:
    com.scholary.mp3: INFO
    software.amazon.awssdk: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} [%X{correlationId}] - %msg%n"
